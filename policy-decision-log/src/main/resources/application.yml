spring:
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: decision-log-writer
      auto-offset-reset: earliest
      max-poll-records: 500
    producer:
      acks: all
      properties:
        linger.ms: 5
        batch.size: 16384
        enable.idempotence: true
        compression.type: lz4

  datasource:
    url: jdbc:postgresql://localhost:5433/opa_logs
    username: opa
    password: opa
    driver-class-name: org.postgresql.Driver
    hikari:
      connection-timeout: 3000
      validation-timeout: 1000
      max-lifetime: 1800000
      idle-timeout: 600000
      minimum-idle: 0
      maximum-pool-size: 10

  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        format_sql: true
        show_sql: false

opa:
  gzip:
    path: /logs
    max-compressed-size: 32768      # 32KB
    max-decompressed-size: 1048576  # 1MB
  infra-failure:
    path: ./logs/infra-failures
  kafka:
    topic: decision-logs
    dlq-topic: decision-logs.dlq
    parking-lot-topic: decision-logs.parking-lot
    parking-dlq-topic: decision-logs.parking-lot.dlq
    fast-producer:
      retries: 1
      delivery-timeout-ms: 8000
      request-timeout-ms: 3000
      max-block-ms: 2000
    parking-producer:
      retries: 2
      delivery-timeout-ms: 20000
      request-timeout-ms: 8000
      max-block-ms: 5000
    dlq-producer:
      retries: 3
      delivery-timeout-ms: 30000
      request-timeout-ms: 12000
      max-block-ms: 5000
    parking-recovery:
      max-retry-attempts: 5
      initial-backoff-ms: 60000      # 1분
      backoff-multiplier: 2.0
      max-backoff-ms: 3600000        # 1시간
    consumer-backoff:
      initial-interval-ms: 1000
      multiplier: 2.0
      max-interval-ms: 10000
      max-elapsed-time-ms: 30000

springdoc:
  show-actuator: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics

logging:
  level:
    root: info
